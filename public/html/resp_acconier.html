<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Suivi ITS - Livraisons</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Les liens vers les fichiers CSS locaux sont conservés comme dans votre original.
         Assurez-vous que ces fichiers sont accessibles depuis le chemin relatif. -->
    <link rel="stylesheet" href="../css/styleDeSuivie.css" />
    <link rel="stylesheet" href="../css/styledeTabBord.css" />
    <link rel="stylesheet" href="../css/style.css" />

    <style>
      /* --- MODERNISATION DU TABLEAU ET DE LA PAGE --- */
      body {
        background: linear-gradient(120deg, #f8fafc 0%, #e0e7ef 100%);
        font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      }
      .container {
        max-width: 1200px;
        margin: 32px auto;
      }
      .card-section {
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 6px 32px 0 rgba(60, 72, 88, 0.10);
        padding: 32px 24px 24px 24px;
        margin-bottom: 32px;
      }
      .section-title {
        font-size: 2.1rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 0.2em;
        letter-spacing: 0.5px;
      }
      .section-subtitle {
        color: #64748b;
        font-size: 1.1rem;
        margin-bottom: 18px;
      }
      /* --- TABLEAU --- */
      .table-responsive {
        background: #f9fafb;
        border-radius: 14px;
        box-shadow: 0 2px 12px 0 rgba(60, 72, 88, 0.07);
        padding: 18px 8px 8px 8px;
        margin-bottom: 0;
      }
      .table {
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 1px 6px 0 rgba(60, 72, 88, 0.06);
        margin-bottom: 0;
      }
      .table th, .table td {
        vertical-align: middle;
        padding: 0.7rem 0.6rem;
        border-color: #e2e8f0;
        font-size: 1.01em;
        background: none;
      }
      .table thead th {
        background: #f1f5f9;
        color: #334155;
        font-weight: 700;
        letter-spacing: 0.03em;
        border-bottom: 2px solid #e2e8f0;
      }
      .table tbody tr {
        transition: box-shadow 0.18s, background 0.18s;
      }
      .table tbody tr:hover {
        background: #e0f2fe !important;
        box-shadow: 0 2px 12px 0 rgba(56, 189, 248, 0.10);
      }
      .table td {
        color: #475569;
      }
      .table th {
        font-size: 1.08em;
      }
      /* --- EN-TÊTES BANDEAUX --- */
      .table thead tr:first-child th {
        border-bottom: none;
        border-top: none;
        padding-top: 12px;
        padding-bottom: 12px;
        color: #fff;
        font-size: 1.18em;
        text-transform: uppercase;
        background: linear-gradient(90deg, #007bff 0%, #ffc107 50%, #28a745 100%);
        letter-spacing: 1.5px;
        box-shadow: 0 2px 8px 0 rgba(60, 72, 88, 0.08);
      }
      .table thead tr:first-child th:nth-child(1) {
        background: #f8f9fa;
        color: #495057;
        border-right: 1px solid #e9ecef;
      }
      .table thead tr:first-child th:nth-child(2) {
        background: #007bff;
      }
      .table thead tr:first-child th:nth-child(3) {
        background: #ffc107;
        color: #856404;
      }
      .table thead tr:first-child th:nth-child(4) {
        background: #28a745;
      }
      .table thead tr:nth-child(2) th {
        position: sticky;
        top: 48px;
        background: #f1f5f9;
        z-index: 10;
        font-size: 1.01em;
      }
      /* --- COLONNES STICKY --- */
      .sticky-col {
        position: sticky;
        z-index: 2;
        background: #f8f9fa;
      }
      .sticky-col-index {
        left: 0;
        min-width: 50px;
        max-width: 70px;
      }
      .sticky-col-agent {
        left: 70px;
        min-width: 120px;
        max-width: 180px;
      }
      /* --- STATUT EN BADGE --- */
      .badge-statut {
        display: inline-block;
        padding: 0.38em 1.1em;
        font-size: 0.98em;
        font-weight: 600;
        border-radius: 16px;
        background: #e2e8f0;
        color: #334155;
        white-space: nowrap;
        box-shadow: 0 1px 4px 0 rgba(60, 72, 88, 0.07);
        letter-spacing: 0.02em;
        min-width: 110px;
        text-align: center;
      }
      .badge-statut.valide { background: #d1fae5; color: #065f46; }
      .badge-statut.en-cours { background: #fef9c3; color: #b45309; }
      .badge-statut.refuse { background: #fee2e2; color: #991b1b; }
      .badge-statut.attente { background: #e0e7ef; color: #334155; }
      /* --- PAGINATION --- */
      .pagination {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 1px 6px 0 rgba(60, 72, 88, 0.06);
        padding: 8px 12px;
      }
      .pagination .page-link {
        color: #007bff;
        border-radius: 6px;
        margin: 0 2px;
        border: none;
        font-weight: 500;
        transition: background 0.15s;
      }
      .pagination .page-link:hover, .pagination .page-link.active {
        background: #e0f2fe;
        color: #0c4a6e;
      }
      /* --- BARRE DE RECHERCHE --- */
      .search-bar-wrapper-top {
        background: #f1f5f9;
        border-radius: 8px;
        box-shadow: 0 1px 4px 0 rgba(60, 72, 88, 0.06);
        padding: 6px 12px;
      }
      .search-wrapper {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .search-input {
        border: none;
        background: transparent;
        outline: none;
        font-size: 1.05em;
        color: #334155;
        flex: 1;
        padding: 6px 0;
      }
      .search-input::placeholder {
        color: #94a3b8;
        opacity: 1;
      }
      .icon-btn-company-color {
        background: #007bff;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 7px 18px;
        font-weight: 600;
        font-size: 1em;
        transition: background 0.18s;
      }
      .icon-btn-company-color:hover {
        background: #0056b3;
      }
      /* --- MESSAGE AUCUNE LIVRAISON --- */
      #noDeliveriesMessage {
        background: #f1f5f9;
        border-radius: 10px;
        padding: 18px 0;
        color: #64748b;
        font-size: 1.1em;
        margin-top: 18px;
      }
      /* --- OVERLAY DE CHARGEMENT --- */
      .loading-overlay {
        background: rgba(255,255,255,0.85);
        border-radius: 12px;
        box-shadow: 0 2px 12px 0 rgba(60, 72, 88, 0.10);
      }
      .loading-spinner-large {
        font-size: 2.5em;
        color: #007bff;
      }
      /* --- RESPONSIVE --- */
      @media (max-width: 900px) {
        .container {
          padding: 0 4px;
        }
        .card-section {
          padding: 18px 4px 12px 4px;
        }
        .table th, .table td {
          font-size: 0.97em;
          padding: 0.5rem 0.3rem;
        }
      }
      @media (max-width: 600px) {
        .section-title {
          font-size: 1.3rem;
        }
        .table-responsive {
          padding: 4px 0;
        }
        .table th, .table td {
          font-size: 0.93em;
          padding: 0.38rem 0.15rem;
        }
        .card-section {
          padding: 8px 2px 6px 2px;
        }
      }
      /* --- ANIMATIONS ET HIGHLIGHT --- */
      .row-blink-green {
        animation: green-blink 1.2s linear 0s 5;
      }
      @keyframes green-blink {
        0% { background-color: #bbf7d0; }
        20% { background-color: #4ade80; }
        40% { background-color: #bbf7d0; }
        60% { background-color: #4ade80; }
        80% { background-color: #bbf7d0; }
        100% { background-color: inherit; }
      }
      .highlight-cell {
        transition: background-color 0.3s ease-in-out;
      }
      .highlight-blue-flash {
        background-color: rgba(0,123,255,0.13) !important;
      }
      .highlight-yellow-flash {
        background-color: rgba(255,193,7,0.13) !important;
      }
      .highlight-green-flash {
        background-color: rgba(40,167,69,0.13) !important;
      }
      /* --- ALERTES --- */
      .custom-alert {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #f8d7da; /* Default background for error */
        color: #721c24; /* Default text color for error */
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 10px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-20px);
        transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out,
          visibility 0.5s linear 0.5s;
        z-index: 1000;
        min-width: 250px;
      }
      .custom-alert.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
        transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out,
          visibility 0.5s linear 0s;
      }
      .custom-alert.hide {
        opacity: 0;
        transform: translateY(-20px);
        transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
      }
      .custom-alert.visually-hidden {
        display: none;
      }
      .custom-alert i {
        font-size: 20px;
      }
      /* Type colors for custom-alert */
      .custom-alert.success {
        background-color: #d4edda;
        color: #155724;
      }
      .custom-alert.error {
        background-color: #f8d7da;
        color: #721c24;
      }
      .custom-alert.warning {
        background-color: #fff3cd;
        color: #856404;
      }
      .custom-alert.info {
        background-color: #d1ecf1;
        color: #0c5460;
      }

      /* Styles for confirmation overlay (conservés de votre version originale) */
      .confirm-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
        display: flex;
        justify-content: center; /* Center horizontally */
        align-items: center; /* Center vertically */
        z-index: 1000; /* Ensure it's on top of other content */
      }
      .confirm-box {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        text-align: center;
        max-width: 400px;
        width: 90%; /* Responsive width */
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      .confirm-box p {
        font-size: 1.1rem;
        color: #333;
        margin-bottom: 15px;
      }
      .confirm-box button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.2s ease;
        margin: 0 5px; /* Add some spacing between buttons */
      }
      .confirm-box button.btn-danger {
        background-color: #dc3545;
        color: white;
      }
      .confirm-box button.btn-danger:hover {
        background-color: #c82333;
      }
      .confirm-box button.btn-secondary {
        background-color: #6c757d;
        color: white;
      }
      .confirm-box button.btn-secondary:hover {
        background-color: #5a6268;
      }

      /* Styles pour la stabilité du tableau (conservés de votre version originale) */
      .table {
        width: 100%;
        table-layout: auto; /* Permet aux colonnes de s'auto-ajuster au contenu */
      }
      .table th,
      .table td {
        vertical-align: top; /* Aligne le contenu en haut des cellules */
        padding: 0.75rem; /* Padding standard de Bootstrap */
        white-space: normal; /* Permet au texte de passer à la ligne */
        word-break: break-word; /* Casse les mots longs pour éviter le débordement */
      }
      .sticky-col {
        position: sticky;
        z-index: 2; /* Plus haut que les cellules normales mais moins que les popups */
        background-color: #f8f9fa; /* Couleur de fond pour les colonnes figées */
      }
      .sticky-col-index {
        left: 0;
        min-width: 50px; /* Largeur minimale pour la colonne N° */
        max-width: 70px; /* Largeur maximale pour la colonne N° */
      }
      .sticky-col-agent {
        /* Calcule le 'left' en fonction de la largeur de la colonne 'N°' */
        left: 70px; /* Assumant 70px de largeur pour sticky-col-index */
        min-width: 120px; /* Largeur minimale pour le nom de l'agent */
        max-width: 180px; /* Largeur maximale pour le nom de l'agent */
      }
      .dropdown-cell-container .dropdown-toggle-button {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* NOUVEAUX STYLES POUR LES BANDEAUX COLORÉS */
      .table thead tr:first-child th {
        border-bottom: none; /* Supprime la bordure inférieure pour le bandeau */
        border-top: none; /* Supprime la bordure supérieure */
        padding-top: 8px;
        padding-bottom: 8px;
        color: white; /* Couleur de texte par défaut pour les bandeaux */
        font-size: 1.1em;
        text-transform: uppercase;
        position: sticky; /* Rendre la ligne de bandeau figée */
        top: 0; /* Coller en haut */
        z-index: 11; /* Plus haut que les en-têtes de colonnes normales */
        cursor: pointer; /* Indique que le bandeau est cliquable */
      }
      /* La première cellule du bandeau (pour N° et Date & Heure) reste neutre */
      .table thead tr:first-child th:nth-child(1) {
        background-color: #f8f9fa; /* Correspond à l'arrière-plan de l'en-tête normal */
        color: #495057; /* Correspond à la couleur de texte de l'en-tête normal */
        border-right: 1px solid #e9ecef; /* Conserver la bordure droite pour la séparation */
        cursor: default; /* Pas de curseur pointeur pour la première colonne */
      }
      /* Styles spécifiques pour chaque bandeau */
      .table thead tr:first-child th:nth-child(2) {
        /* Agent Acconier (bleu) */
        background-color: #007bff; /* Bleu */
        border-right: none; /* Supprime la bordure droite pour fusionner avec le bandeau suivant */
      }
      .table thead tr:first-child th:nth-child(3) {
        /* Responsable Acconier (jaune) */
        background-color: #ffc107; /* Jaune */
        border-right: none; /* Supprime la bordure droite pour fusionner avec le bandeau suivant */
      }
      .table thead tr:first-child th:nth-child(4) {
        /* Responsable de livraison (vert) */
        background-color: #28a745; /* Vert */
        border-right: 1px solid #e9ecef; /* Assure une bordure droite */
      }

      /* Rendre la deuxième ligne d'en-tête (vos en-têtes de colonnes originaux) figée en dessous du bandeau */
      .table thead tr:nth-child(2) th {
        position: sticky;
        top: 40px; /* Ajuster cette valeur en fonction de la hauteur réelle du bandeau (environ 40px) */
        background-color: #f8f9fa; /* Assurez-vous que le fond correspond à votre design */
        z-index: 10; /* Inférieur aux colonnes sticky-col pour qu'elles soient au-dessus */
      }

      /* S'assurer que les en-têtes des colonnes figées sont au-dessus de l'en-tête de table général */
      .table thead tr:nth-child(2) .sticky-col {
        z-index: 12; /* Plus haut que le bandeau et l'en-tête de table général */
      }

      /* Animation clignotement vert pour nouvelle ligne */
      @keyframes green-blink {
        0% {
          background-color: #bbf7d0;
        }
        20% {
          background-color: #4ade80;
        }
        40% {
          background-color: #bbf7d0;
        }
        60% {
          background-color: #4ade80;
        }
        80% {
          background-color: #bbf7d0;
        }
        100% {
          background-color: inherit;
        }
      }
      .row-blink-green {
        animation: green-blink 1.2s linear 0s 5;
      }

      /* Styles pour l'effet de mise en évidence */
      .highlight-cell {
        transition: background-color 0.3s ease-in-out; /* Transition douce pour l'effet de flash */
      }
      .highlight-blue-flash {
        background-color: rgba(
          0,
          123,
          255,
          0.2
        ) !important; /* Bleu avec opacité légère */
      }
      .highlight-yellow-flash {
        background-color: rgba(
          255,
          193,
          7,
          0.2
        ) !important; /* Jaune avec opacité légère */
      }
      .highlight-green-flash {
        background-color: rgba(
          40,
          167,
          69,
          0.2
        ) !important; /* Vert avec opacité légère */
      }
    </style>
  </head>

  <body class="bg-light">
    <div class="container my-4">
      <section class="card-section">
        <div class="header-with-search">
          <div>
            <h1 class="section-title">Tableau - Reponsable Acconier</h1>
            <p class="section-subtitle">
              Paiement de l'acconage des conteneurs 
            </p>
            <!-- BARRE DE DÉFILEMENT POUR LES AGENTS (conservée de votre version originale) -->
            <div class="scrolling-message-bar" id="newAgentScrollingContainer">
              <div
                class="scrolling-message-content"
                id="newAgentScrollingContent"
              >
                <!-- Le contenu des agents défilants sera injecté ici par JS -->
              </div>
            </div>
          </div>


        </div>

        <div
          class="d-flex justify-content-center align-items-center mb-3 flex-wrap gap-2"
        >
          <input
            type="date"
            id="mainTableDateFilter"
            class="icon-btn icon-btn-company-color"
            title="Filtrer par date"
          />
          <span style="display:inline-block;width:1.5px;height:32px;background:#d1d5db;margin:0 18px;vertical-align:middle;border-radius:2px;"></span>
          <div class="search-bar-wrapper-top" style="min-width:260px;max-width:400px;flex:1 1 260px;">
            <div class="search-wrapper">
              <i class="fas fa-search search-icon"></i>
              <input
                type="search"
                id="searchInput"
                class="search-input"
                placeholder="Rechercher une livraison..."
                aria-label="Recherche"
              />
              <button id="searchButton" class="icon-btn-company-color">
                <i
                  class="fas fa-spinner fa-spin loading-spinner"
                  style="display: none"
                ></i>
                Rechercher
              </button>
            </div>
          </div>
        </div>

        <div id="tableScrollContainer" class="table-responsive overflow-x-auto">
          <table
            id="deliveriesTable"
            class="table table-bordered table-hover align-middle"
          >
            <thead>
              <tr>
                <th
                  colspan="31"
                  id="agentAcconierHeader"
                  class="header-agent-acconier"
                >
                  Responsable Acconier
                </th>
              </tr>
              <tr id="deliveriesTableHead">
                <th>N°</th>
                <th>Date</th>
                <th>Agent</th>
                <th>Client (Nom)</th>
                <th>Client (Tél)</th>
                <th>Numéro TC(s)</th>
                <th>Lieu</th>
                <th>Type Conteneur (pied)</th>
                <th>Contenu</th>
                <th>N° Déclaration</th>
                <th>N° BL</th>
                <th>N° Dossier</th>
                <th>Nombre de conteneurs</th>
                <th>Compagnie Maritime</th>
                <th>Poids</th>
                <th>Nom du navire</th>
                <th>Circuit</th>
                <th>Mode de Transport</th>
                <th>Statut Dossier</th>
                <th>Observation</th>
              </tr>
            </thead>

            <tbody id="deliveriesTableBody">
              <!-- Les lignes seront générées dynamiquement par JS -->
              <tr>
                <td colspan="31" class="text-center text-muted">
                  <i class="fas fa-spinner fa-spin me-2"></i> Chargement des
                  livraisons...
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <nav aria-label="Pagination livraisons" class="mt-3">
          <ul class="pagination justify-content-center" id="pagination"></ul>
        </nav>

        <div
          id="noDeliveriesMessage"
          class="text-center mt-3 text-muted d-none"
        >
          <i class="fas fa-box-open me-1"></i> Aucune livraison enregistrée pour
          le moment.
        </div>
      </section>
    </div>
        <p id="countdownMessage" class="countdown-message d-none"></p>
      </div>
    </div>

    <!-- IMPORTANT: J'ai ajouté cet élément, il était référencé dans votre JS mais manquant dans le HTML -->
    <div id="loadingOverlay" class="loading-overlay d-none">
      <div class="loading-overlay-content">
        <i class="fas fa-spinner fa-spin loading-spinner-large mb-3"></i>
        <p class="loading-overlay-text">Chargement...</p>
      </div>
    </div>

    <div id="customAlert" class="custom-alert">
      <h3 id="customAlertTitle" class="custom-alert-title"></h3>
      <p id="customAlertMessage" class="custom-alert-message"></p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Script pour styliser les statuts en badges colorés (si pas déjà fait côté JS)
      document.addEventListener('DOMContentLoaded', function () {
        const tableBody = document.getElementById('deliveriesTableBody');
        if (!tableBody) return;
        function styliseStatutBadges() {
          const statutCells = tableBody.querySelectorAll('td:nth-child(19)');
          statutCells.forEach(cell => {
            if (cell.classList.contains('badge-statut')) return;
            let val = cell.textContent.trim().toLowerCase();
            let badgeClass = 'badge-statut';
            if (val.includes('valid')) badgeClass += ' valide';
            else if (val.includes('cours')) badgeClass += ' en-cours';
            else if (val.includes('refus')) badgeClass += ' refuse';
            else if (val.includes('attente')) badgeClass += ' attente';
            cell.className = badgeClass;
          });
        }
        // Premier passage
        styliseStatutBadges();
        // Si le tableau est mis à jour dynamiquement, observer les changements
        const observer = new MutationObserver(styliseStatutBadges);
        observer.observe(tableBody, { childList: true, subtree: true });
      });
    </script>
    <script src="../js/scriptRespAcconier.js"></script>
  </body>
</html>

