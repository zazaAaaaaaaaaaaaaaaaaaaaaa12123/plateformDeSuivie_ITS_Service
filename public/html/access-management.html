<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestion des Acc√®s - ITS Service</title>
    <!-- TAILWIND CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FONT AWESOME -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- CSS personnalis√© am√©lior√© -->
    <link rel="stylesheet" href="../css/access-management-enhanced.css" />
    <style>
      .access-card {
        transition: all 0.3s ease;
      }
      .access-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }
      .status-pending {
        background: linear-gradient(45deg, #fbbf24, #f59e0b);
      }
      .status-approved {
        background: linear-gradient(45deg, #10b981, #059669);
      }
      .status-rejected {
        background: linear-gradient(45deg, #ef4444, #dc2626);
      }
      .password-generate {
        font-family: "Courier New", monospace;
        letter-spacing: 2px;
      }
      .stat-card {
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
      }
      .stat-card.active {
        border: 2px solid #3b82f6;
        transform: translateY(-2px);
      }
      .timeline-item {
        position: relative;
        padding-left: 2rem;
        margin-bottom: 1rem;
      }

      /* Indicateur de nouvelle demande sur les onglets */
      .section-tab {
        position: relative;
      }

      .section-tab .notification-indicator {
        position: absolute;
        top: 8px;
        right: 12px;
        width: 12px;
        height: 12px;
        background: #ef4444;
        border: 2px solid white;
        border-radius: 50%;
        animation: pulse-notification 2s infinite;
        z-index: 10;
      }

      @keyframes pulse-notification {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.2);
          opacity: 0.8;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* Style pour les onglets avec notifications */
      .section-tab.has-notification {
        background: linear-gradient(45deg, #fef3c7, #fbbf24) !important;
        color: #92400e !important;
        font-weight: 600;
      }
      .timeline-item::before {
        content: "";
        position: absolute;
        left: 0.5rem;
        top: 0.5rem;
        width: 0.75rem;
        height: 0.75rem;
        border-radius: 50%;
        background: #3b82f6;
      }
      .timeline-item::after {
        content: "";
        position: absolute;
        left: 0.875rem;
        top: 1.25rem;
        width: 2px;
        height: calc(100% - 1rem);
        background: #e5e7eb;
      }
      .timeline-item:last-child::after {
        display: none;
      }

      /* Styles pour les sections d'acteurs */
      .section-tab {
        position: relative;
        overflow: hidden;
      }

      .section-tab.active {
        background-color: #eff6ff;
        color: #2563eb;
        border-bottom-color: #2563eb;
      }

      .section-content {
        transition: all 0.3s ease-in-out;
      }

      .section-content.hidden {
        display: none;
      }

      /* Animations pour les cartes d'acteurs */
      .actor-card {
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
      }

      .actor-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      .actor-card.responsable-acconier {
        border-left-color: #3b82f6;
      }

      .actor-card.responsable-livraison {
        border-left-color: #10b981;
      }

      .actor-card.agent-transit {
        border-left-color: #8b5cf6;
      }

      /* Badge pour le type d'acteur */
      .actor-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        font-weight: 500;
      }

      .actor-badge.responsable-acconier {
        background-color: #dbeafe;
        color: #1e40af;
      }

      .actor-badge.responsable-livraison {
        background-color: #d1fae5;
        color: #065f46;
      }

      .actor-badge.agent-transit {
        background-color: #ede9fe;
        color: #5b21b6;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- HEADER -->
    <header class="bg-blue-900 shadow-lg sticky top-0 z-40">
      <div class="container mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <i class="fas fa-key text-yellow-400 text-2xl"></i>
            <h1 class="text-2xl font-bold text-white">Gestion des Acc√®s ITS</h1>
          </div>
          <div class="flex items-center space-x-4">
            <!-- Bouton de basculement du th√®me -->
            <button
              onclick="toggleTheme()"
              class="bg-blue-800 hover:bg-blue-700 text-white p-2 rounded-lg transition-all duration-200"
              title="Basculer le th√®me"
            >
              <i class="fas fa-moon text-yellow-400"></i>
            </button>

            <!-- Bouton d'activation du th√®me personnalis√© -->
            <button
              onclick="activateCustomTheme()"
              class="bg-blue-800 hover:bg-blue-700 text-white p-2 rounded-lg transition-all duration-200"
              title="Activer le th√®me personnalis√©"
            >
              <i class="fas fa-paint-brush text-green-400"></i>
            </button>

            <!-- Bouton de personnalisation -->
            <button
              onclick="openThemeCustomizer()"
              class="bg-blue-800 hover:bg-blue-700 text-white p-2 rounded-lg transition-all duration-200"
              title="Personnaliser les couleurs"
            >
              <i class="fas fa-cog text-orange-400"></i>
            </button>

            <!-- üë§ AVATAR ADMINISTRATEUR -->
            <div id="adminAvatar" class="relative">
              <div
                class="flex items-center cursor-pointer bg-blue-800 hover:bg-blue-700 rounded-full px-4 py-2 transition-all duration-200"
                onclick="toggleUserProfile()"
              >
                <div class="relative">
                  <img
                    src="https://cdn-icons-png.flaticon.com/512/1048/1048953.png"
                    alt="Avatar Admin"
                    class="profile-avatar w-8 h-8 rounded-full mr-3 border-2 border-yellow-400"
                  />
                  <button
                    onclick="event.stopPropagation(); openProfilePhotoModal()"
                    class="absolute -bottom-1 -right-1 bg-yellow-400 hover:bg-yellow-300 text-blue-900 rounded-full w-5 h-5 flex items-center justify-center text-xs transition-all duration-200"
                    title="Changer la photo"
                  >
                    <i class="fas fa-camera"></i>
                  </button>
                </div>
                <div class="text-left">
                  <div
                    id="adminName"
                    class="text-yellow-300 font-medium text-sm"
                  >
                    Admin
                  </div>
                  <div id="adminRole" class="text-yellow-200 text-xs">
                    Administrateur
                  </div>
                </div>
                <i
                  class="fas fa-chevron-down text-yellow-300 ml-2 text-sm"
                  id="avatarChevron"
                ></i>
              </div>

              <!-- üìã POPUP PROFIL UTILISATEUR -->
              <div
                id="userProfilePopup"
                class="absolute right-0 top-full mt-2 w-80 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 hidden"
              >
                <div class="p-4 border-b border-gray-100">
                  <div class="flex items-center space-x-3">
                    <div class="relative">
                      <img
                        src="https://cdn-icons-png.flaticon.com/512/1048/1048953.png"
                        alt="Avatar Admin"
                        class="profile-avatar w-12 h-12 rounded-full border-2 border-blue-500"
                      />
                      <button
                        onclick="openProfilePhotoModal()"
                        class="absolute -bottom-1 -right-1 bg-blue-500 hover:bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs transition-all duration-200"
                        title="Changer la photo"
                      >
                        <i class="fas fa-camera"></i>
                      </button>
                    </div>
                    <div>
                      <h3 id="profileName" class="font-bold text-gray-800">
                        Administrateur
                      </h3>
                      <p id="profileEmail" class="text-gray-600 text-sm">
                        admin@itservice.ci
                      </p>
                      <span
                        class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mt-1"
                      >
                        Acc√®s Complet
                      </span>
                    </div>
                  </div>
                </div>
                <div class="p-4">
                  <div class="space-y-3">
                    <div class="flex items-center text-gray-700">
                      <i class="fas fa-clock w-5 text-blue-500 mr-3"></i>
                      <span class="text-sm"
                        >Derni√®re connexion:
                        <span id="lastLoginTime">Maintenant</span></span
                      >
                    </div>
                    <div class="flex items-center text-gray-700">
                      <i class="fas fa-shield-alt w-5 text-green-500 mr-3"></i>
                      <span class="text-sm"
                        >Niveau d'acc√®s: Administrateur</span
                      >
                    </div>
                    <div class="flex items-center text-gray-700">
                      <i class="fas fa-server w-5 text-purple-500 mr-3"></i>
                      <span class="text-sm">Syst√®me: Gestion d'Acc√®s ITS</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <button
              onclick="logout()"
              class="bg-yellow-400 hover:bg-yellow-300 text-blue-900 px-4 py-2 rounded-lg font-medium transition"
            >
              <i class="fas fa-sign-out-alt mr-2"></i>D√©connexion
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="container mx-auto px-6 py-8">
      <!-- SECTIONS DE NAVIGATION PAR ACTEUR -->
      <div class="bg-white rounded-xl shadow-lg mb-8 overflow-hidden">
        <div class="border-b border-gray-200">
          <nav class="flex space-x-0" aria-label="Sections par acteur">
            <button
              onclick="switchSection('global')"
              class="section-tab flex-1 px-6 py-4 text-center font-medium text-sm border-b-2 transition-all duration-200 border-blue-500 text-blue-600 bg-blue-50"
              data-section="global"
              id="tab-global"
            >
              <i class="fas fa-tachometer-alt mr-2"></i>
              Vue Globale
            </button>
            <button
              onclick="switchSection('responsable-acconier')"
              class="section-tab flex-1 px-6 py-4 text-center font-medium text-sm border-b-2 transition-all duration-200 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"
              data-section="responsable-acconier"
              id="tab-responsable-acconier"
            >
              <i class="fas fa-anchor mr-2"></i>
              Responsable Acconier
            </button>
            <button
              onclick="switchSection('responsable-livraison')"
              class="section-tab flex-1 px-6 py-4 text-center font-medium text-sm border-b-2 transition-all duration-200 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"
              data-section="responsable-livraison"
              id="tab-responsable-livraison"
            >
              <i class="fas fa-truck mr-2"></i>
              Responsable de Livraison
            </button>
            <button
              onclick="switchSection('agent-transit')"
              class="section-tab flex-1 px-6 py-4 text-center font-medium text-sm border-b-2 transition-all duration-200 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"
              data-section="agent-transit"
              id="tab-agent-transit"
            >
              <i class="fas fa-user-tie mr-2"></i>
              Agent Transit (Acconier)
            </button>
          </nav>
        </div>
      </div>

      <!-- SECTION VUE GLOBALE -->
      <div id="section-global" class="section-content">
        <!-- STATISTICS -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div
            class="stat-card bg-white rounded-xl shadow-md p-6 border-l-4 border-yellow-400 hover:shadow-lg"
            onclick="filterRequests('all')"
            data-filter="all"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-600">Total Demandes</p>
                <p class="text-2xl font-bold text-gray-900" id="totalRequests">
                  0
                </p>
              </div>
              <i class="fas fa-inbox text-yellow-400 text-2xl"></i>
            </div>
          </div>
          <div
            class="stat-card bg-white rounded-xl shadow-md p-6 border-l-4 border-orange-400 hover:shadow-lg"
            onclick="filterRequests('pending')"
            data-filter="pending"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-600">En Attente</p>
                <p
                  class="text-2xl font-bold text-orange-600"
                  id="pendingRequests"
                >
                  0
                </p>
              </div>
              <i class="fas fa-clock text-orange-400 text-2xl"></i>
            </div>
          </div>
          <div
            class="stat-card bg-white rounded-xl shadow-md p-6 border-l-4 border-green-400 hover:shadow-lg"
            onclick="filterRequests('approved')"
            data-filter="approved"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-600">Approuv√©es</p>
                <p
                  class="text-2xl font-bold text-green-600"
                  id="approvedRequests"
                >
                  0
                </p>
              </div>
              <i class="fas fa-check-circle text-green-400 text-2xl"></i>
            </div>
          </div>
          <div
            class="stat-card bg-white rounded-xl shadow-md p-6 border-l-4 border-red-400 hover:shadow-lg"
            onclick="filterRequests('rejected')"
            data-filter="rejected"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-600">Rejet√©es</p>
                <p
                  class="text-2xl font-bold text-red-600"
                  id="rejectedRequests"
                >
                  0
                </p>
              </div>
              <i class="fas fa-times-circle text-red-400 text-2xl"></i>
            </div>
          </div>
        </div>

        <!-- HISTORIQUE PAR DATE -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
          <!-- Historique journalier -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-bold text-gray-800">
                <i class="fas fa-calendar-day mr-2 text-blue-600"></i>
                Historique Journalier
              </h3>
              <div class="relative">
                <select
                  id="dateFilter"
                  class="appearance-none bg-blue-50 border-2 border-blue-200 text-blue-800 text-sm rounded-lg px-4 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 cursor-pointer hover:bg-blue-100"
                >
                  <option value="today" class="bg-white text-blue-800">
                    Aujourd'hui
                  </option>
                  <option value="yesterday" class="bg-white text-blue-800">
                    Hier
                  </option>
                  <option value="week" class="bg-white text-blue-800">
                    Cette semaine
                  </option>
                  <option value="month" class="bg-white text-blue-800">
                    Ce mois
                  </option>
                </select>
                <div
                  class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-blue-600"
                >
                  <i class="fas fa-chevron-down text-sm"></i>
                </div>
              </div>
            </div>
            <div id="dailyHistory" class="space-y-3 max-h-64 overflow-y-auto">
              <!-- L'historique sera affich√© ici -->
            </div>
          </div>

          <!-- Activit√© r√©cente -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">
              <i class="fas fa-clock mr-2 text-green-600"></i>
              Activit√© R√©cente
            </h3>
            <div id="recentActivity" class="space-y-3 max-h-64 overflow-y-auto">
              <!-- L'activit√© r√©cente sera affich√©e ici -->
            </div>
          </div>

          <!-- Statistiques avanc√©es -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">
              <i class="fas fa-chart-bar mr-2 text-purple-600"></i>
              Statistiques
            </h3>
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600">Taux d'approbation</span>
                <span class="font-bold text-green-600" id="approvalRate"
                  >0%</span
                >
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600"
                  >Temps de traitement moyen</span
                >
                <span class="font-bold text-blue-600" id="avgProcessingTime"
                  >0h</span
                >
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600">Demandes aujourd'hui</span>
                <span class="font-bold text-orange-600" id="todayRequests"
                  >0</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SECTION RESPONSABLE ACCONIER -->
      <div id="section-responsable-acconier" class="section-content hidden">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
          <div class="flex items-center mb-6">
            <div class="bg-blue-100 p-3 rounded-full mr-4">
              <i class="fas fa-anchor text-blue-600 text-2xl"></i>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-gray-800">
                Gestion des Acc√®s - Responsable Acconier
              </h2>
              <p class="text-gray-600">
                Demandes d'acc√®s pour les responsables acconiers
              </p>
            </div>
          </div>

          <!-- Statistiques sp√©cifiques aux Responsables Acconier -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div
              class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-blue-100 text-sm">Total Demandes Acconier</p>
                  <p class="text-2xl font-bold" id="acconiersTotal">0</p>
                </div>
                <i class="fas fa-anchor text-3xl text-blue-200"></i>
              </div>
            </div>
            <div
              class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-white"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-orange-100 text-sm">En Attente</p>
                  <p class="text-2xl font-bold" id="acconiersPending">0</p>
                </div>
                <i class="fas fa-clock text-3xl text-orange-200"></i>
              </div>
            </div>
            <div
              class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-green-100 text-sm">Approuv√©es</p>
                  <p class="text-2xl font-bold" id="acconiersApproved">0</p>
                </div>
                <i class="fas fa-check-circle text-3xl text-green-200"></i>
              </div>
            </div>
          </div>

          <!-- Liste des demandes Responsable Acconier -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
              <i class="fas fa-list mr-2"></i>Demandes Responsable Acconier
            </h3>
            <div id="acconiersRequestsList" class="space-y-3">
              <!-- Les demandes seront affich√©es ici -->
            </div>
            <div
              id="noAcconiersRequests"
              class="text-center py-8 text-gray-500"
            >
              <i class="fas fa-anchor text-4xl mb-4"></i>
              <p>Aucune demande de responsable acconier</p>
            </div>
          </div>
        </div>
      </div>

      <!-- SECTION RESPONSABLE DE LIVRAISON -->
      <div id="section-responsable-livraison" class="section-content hidden">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
          <div class="flex items-center mb-6">
            <div class="bg-green-100 p-3 rounded-full mr-4">
              <i class="fas fa-truck text-green-600 text-2xl"></i>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-gray-800">
                Gestion des Acc√®s - Responsable de Livraison
              </h2>
              <p class="text-gray-600">
                Demandes d'acc√®s pour les responsables de livraison
              </p>
            </div>
          </div>

          <!-- Statistiques sp√©cifiques aux Responsables de Livraison -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div
              class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-green-100 text-sm">Total Demandes Livraison</p>
                  <p class="text-2xl font-bold" id="livraisonTotal">0</p>
                </div>
                <i class="fas fa-truck text-3xl text-green-200"></i>
              </div>
            </div>
            <div
              class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-white"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-orange-100 text-sm">En Attente</p>
                  <p class="text-2xl font-bold" id="livraisonPending">0</p>
                </div>
                <i class="fas fa-clock text-3xl text-orange-200"></i>
              </div>
            </div>
            <div
              class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-blue-100 text-sm">Approuv√©es</p>
                  <p class="text-2xl font-bold" id="livraisonApproved">0</p>
                </div>
                <i class="fas fa-check-circle text-3xl text-blue-200"></i>
              </div>
            </div>
          </div>

          <!-- Liste des demandes Responsable de Livraison -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
              <i class="fas fa-list mr-2"></i>Demandes Responsable de Livraison
            </h3>
            <div id="livraisonRequestsList" class="space-y-3">
              <!-- Les demandes seront affich√©es ici -->
            </div>
            <div
              id="noLivraisonRequests"
              class="text-center py-8 text-gray-500"
            >
              <i class="fas fa-truck text-4xl mb-4"></i>
              <p>Aucune demande de responsable de livraison</p>
            </div>
          </div>
        </div>
      </div>

      <!-- SECTION AGENT TRANSIT (ACCONIER) -->
      <div id="section-agent-transit" class="section-content hidden">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
          <div class="flex items-center mb-6">
            <div class="bg-purple-100 p-3 rounded-full mr-4">
              <i class="fas fa-user-tie text-purple-600 text-2xl"></i>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-gray-800">
                Gestion des Acc√®s - Agent Transit (Acconier)
              </h2>
              <p class="text-gray-600">
                Demandes d'acc√®s pour les agents transit acconiers
              </p>
            </div>
          </div>

          <!-- Statistiques sp√©cifiques aux Agents Transit -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div
              class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-purple-100 text-sm">Total Demandes Agents</p>
                  <p class="text-2xl font-bold" id="agentsTotal">0</p>
                </div>
                <i class="fas fa-user-tie text-3xl text-purple-200"></i>
              </div>
            </div>
            <div
              class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-white"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-orange-100 text-sm">En Attente</p>
                  <p class="text-2xl font-bold" id="agentsPending">0</p>
                </div>
                <i class="fas fa-clock text-3xl text-orange-200"></i>
              </div>
            </div>
            <div
              class="bg-gradient-to-r from-teal-500 to-teal-600 rounded-xl p-6 text-white"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-teal-100 text-sm">Approuv√©es</p>
                  <p class="text-2xl font-bold" id="agentsApproved">0</p>
                </div>
                <i class="fas fa-check-circle text-3xl text-teal-200"></i>
              </div>
            </div>
          </div>

          <!-- Liste des demandes Agent Transit -->
          <div class="bg-gray-50 rounded-lg p-4">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-gray-800">
                <i class="fas fa-list mr-2"></i>Demandes Agent Transit
                (Acconier)
              </h3>
              <button
                onclick="forceRefreshRequests()"
                class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg transition flex items-center space-x-2"
                title="Actualiser les demandes"
              >
                <i class="fas fa-sync-alt"></i>
                <span class="hidden sm:inline">Actualiser</span>
              </button>
            </div>
            <div id="agentsRequestsList" class="space-y-3">
              <!-- Les demandes seront affich√©es ici -->
            </div>
            <div id="noAgentsRequests" class="text-center py-8 text-gray-500">
              <i class="fas fa-user-tie text-4xl mb-4"></i>
              <p>Aucune demande d'agent transit</p>
            </div>
          </div>
        </div>
      </div>

      <!-- REQUESTS LIST (section globale existante) -->
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="px-6 py-4 bg-blue-900 text-white">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-bold flex items-center">
              <i class="fas fa-list-alt mr-3"></i>
              <span id="requestsTitle">Demandes d'Acc√®s</span>
            </h2>
            <div class="flex items-center space-x-3">
              <!-- üóëÔ∏è BOUTON SUPPRESSION MULTIPLE -->
              <button
                onclick="deleteSelectedRequests()"
                id="deleteSelectedBtn"
                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium hidden transition"
              >
                <i class="fas fa-trash mr-2"></i>Supprimer S√©lectionn√©es
              </button>

              <!-- ‚úÖ BOUTON S√âLECTIONNER TOUT -->
              <button
                onclick="toggleSelectAll()"
                id="selectAllBtn"
                class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition"
              >
                <i class="fas fa-check-square mr-2"></i>Tout S√©lectionner
              </button>

              <button
                onclick="clearFilter()"
                id="clearFilterBtn"
                class="bg-yellow-400 hover:bg-yellow-300 text-blue-900 px-3 py-1 rounded text-sm font-medium hidden"
              >
                Tout Afficher
              </button>
              <div class="text-sm bg-blue-800 px-3 py-1 rounded">
                <span id="requestsCount">0</span> demande(s)
                <span
                  id="selectedCount"
                  class="hidden ml-2 bg-red-600 px-2 py-1 rounded"
                  >0 s√©lectionn√©e(s)</span
                >
              </div>
            </div>
          </div>
        </div>
        <div class="p-6">
          <div id="requestsList" class="space-y-4">
            <!-- Les demandes seront ajout√©es ici dynamiquement -->
          </div>
          <div id="noRequests" class="text-center py-12 text-gray-500">
            <i class="fas fa-inbox text-4xl mb-4"></i>
            <p class="text-lg" id="noRequestsMessage">
              Aucune demande d'acc√®s en attente
            </p>
          </div>
        </div>
      </div>
    </main>

    <!-- MODAL DE TRAITEMENT -->
    <div
      id="processModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4">
        <div class="px-6 py-4 bg-blue-900 text-white rounded-t-xl">
          <h3 class="text-lg font-bold">Traiter la Demande d'Acc√®s</h3>
        </div>
        <div class="p-6">
          <div class="mb-4">
            <h4 class="font-semibold text-gray-800 mb-2">
              Informations Utilisateur
            </h4>
            <div class="bg-gray-50 p-4 rounded-lg">
              <p><strong>Nom:</strong> <span id="modalUserName"></span></p>
              <p><strong>Email:</strong> <span id="modalUserEmail"></span></p>
              <p>
                <strong>Date demande:</strong>
                <span id="modalRequestDate"></span>
              </p>
            </div>
          </div>

          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Email de l'utilisateur</label
            >
            <input
              type="email"
              id="userEmailInput"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              readonly
            />
          </div>

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Mot de passe g√©n√©r√©</label
            >
            <div class="flex items-center space-x-2">
              <input
                type="text"
                id="generatedPassword"
                class="flex-1 p-3 border border-gray-300 rounded-lg password-generate bg-gray-50"
                readonly
              />
              <button
                onclick="generatePassword()"
                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg transition"
              >
                <i class="fas fa-refresh"></i>
              </button>
              <button
                onclick="copyPassword()"
                class="bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg transition"
              >
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </div>

          <div class="flex space-x-3">
            <button
              onclick="approveRequest()"
              class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium transition"
            >
              <i class="fas fa-check mr-2"></i>Approuver
            </button>
            <button
              onclick="rejectRequest()"
              class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-medium transition"
            >
              <i class="fas fa-times mr-2"></i>Rejeter
            </button>
            <button
              onclick="closeModal()"
              class="px-6 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg font-medium transition"
            >
              Annuler
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL ENVOI CODE D'ACC√àS -->
    <div
      id="sendAccessCodeModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4">
        <div class="px-6 py-4 bg-green-600 text-white rounded-t-xl">
          <h3 class="text-lg font-bold">Envoyer Code d'Acc√®s</h3>
        </div>
        <div class="p-6">
          <div class="mb-4">
            <h4 class="font-semibold text-gray-800 mb-2">
              Informations Utilisateur
            </h4>
            <div class="bg-gray-50 p-4 rounded-lg">
              <p><strong>Nom:</strong> <span id="sendModalUserName"></span></p>
              <p>
                <strong>Email:</strong> <span id="sendModalUserEmail"></span>
              </p>
              <p>
                <strong>Type:</strong>
                <span
                  id="sendModalRequestType"
                  class="px-2 py-1 rounded-full text-xs font-medium"
                ></span>
              </p>
            </div>
          </div>

          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Email de l'utilisateur</label
            >
            <input
              type="email"
              id="sendUserEmailInput"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
              readonly
            />
          </div>

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Nouveau code d'acc√®s</label
            >
            <div class="flex items-center space-x-2">
              <input
                type="text"
                id="newAccessCode"
                class="flex-1 p-3 border border-gray-300 rounded-lg password-generate bg-gray-50"
                readonly
              />
              <button
                onclick="generateNewAccessCode()"
                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg transition"
                title="G√©n√©rer un nouveau code"
              >
                <i class="fas fa-refresh"></i>
              </button>
              <button
                onclick="copyNewAccessCode()"
                class="bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg transition"
                title="Copier le code"
              >
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </div>

          <div class="flex space-x-3">
            <button
              onclick="sendAccessCodeByEmail()"
              class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium transition"
              id="sendAccessCodeBtn"
            >
              <i class="fas fa-paper-plane mr-2"></i>
              <span id="sendAccessCodeText">Envoyer par Email</span>
              <span id="sendAccessCodeLoading" class="hidden">
                <i class="fas fa-spinner fa-spin mr-2"></i>Envoi...
              </span>
            </button>
            <button
              onclick="closeSendAccessCodeModal()"
              class="px-6 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg font-medium transition"
            >
              Annuler
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL DE PERSONNALISATION DU TH√àME -->
    <div
      id="themeCustomizerModal"
      class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden"
    >
      <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
          <div
            class="flex items-center justify-between p-6 border-b border-gray-200"
          >
            <h3 class="text-lg font-bold text-gray-800">
              <i class="fas fa-palette text-blue-500 mr-2"></i>
              Personnaliser les couleurs
            </h3>
            <button
              onclick="closeThemeCustomizer()"
              class="text-gray-500 hover:text-gray-700 text-xl"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>

          <div class="p-6 space-y-4">
            <!-- Couleur principale -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Couleur principale
              </label>
              <div class="flex items-center space-x-3">
                <input
                  type="color"
                  id="primaryColor"
                  value="#3b82f6"
                  class="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer"
                />
                <span class="text-sm text-gray-600"
                  >Couleur des boutons et accents</span
                >
              </div>
            </div>

            <!-- Couleur secondaire -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Couleur secondaire
              </label>
              <div class="flex items-center space-x-3">
                <input
                  type="color"
                  id="secondaryColor"
                  value="#1f2937"
                  class="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer"
                />
                <span class="text-sm text-gray-600"
                  >Couleur du header et navigation</span
                >
              </div>
            </div>

            <!-- Couleur d'accent -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Couleur d'accent
              </label>
              <div class="flex items-center space-x-3">
                <input
                  type="color"
                  id="accentColor"
                  value="#f59e0b"
                  class="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer"
                />
                <span class="text-sm text-gray-600"
                  >Couleur des √©l√©ments mis en valeur</span
                >
              </div>
            </div>

            <!-- Couleur de fond -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Couleur de fond
              </label>
              <div class="flex items-center space-x-3">
                <input
                  type="color"
                  id="backgroundColor"
                  value="#ffffff"
                  class="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer"
                />
                <span class="text-sm text-gray-600"
                  >Couleur de fond principale</span
                >
              </div>
            </div>

            <!-- Couleur de surface -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Couleur de surface
              </label>
              <div class="flex items-center space-x-3">
                <input
                  type="color"
                  id="surfaceColor"
                  value="#f9fafb"
                  class="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer"
                />
                <span class="text-sm text-gray-600"
                  >Couleur des cartes et surfaces</span
                >
              </div>
            </div>
          </div>

          <!-- Section Couleurs des Cartes de Statistiques -->
          <div class="px-6 py-4 border-t border-gray-200">
            <h4
              class="text-lg font-semibold text-gray-800 mb-4 flex items-center"
            >
              <i class="fas fa-chart-bar mr-2 text-blue-600"></i>
              Couleurs des Cartes de Statistiques
            </h4>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Couleur Total Demandes -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Total Demandes
                </label>
                <div class="flex items-center space-x-3">
                  <input
                    type="color"
                    id="cardTotalColor"
                    value="#f97316"
                    class="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer"
                  />
                  <span class="text-sm text-gray-600"
                    >Couleur de la carte "Total Demandes"</span
                  >
                </div>
              </div>

              <!-- Couleur En Attente -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  En Attente
                </label>
                <div class="flex items-center space-x-3">
                  <input
                    type="color"
                    id="cardPendingColor"
                    value="#f59e0b"
                    class="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer"
                  />
                  <span class="text-sm text-gray-600"
                    >Couleur de la carte "En Attente"</span
                  >
                </div>
              </div>

              <!-- Couleur Approuv√©es -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Approuv√©es
                </label>
                <div class="flex items-center space-x-3">
                  <input
                    type="color"
                    id="cardApprovedColor"
                    value="#10b981"
                    class="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer"
                  />
                  <span class="text-sm text-gray-600"
                    >Couleur de la carte "Approuv√©es"</span
                  >
                </div>
              </div>

              <!-- Couleur Rejet√©es -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Rejet√©es
                </label>
                <div class="flex items-center space-x-3">
                  <input
                    type="color"
                    id="cardRejectedColor"
                    value="#ef4444"
                    class="w-12 h-10 rounded-lg border border-gray-300 cursor-pointer"
                  />
                  <span class="text-sm text-gray-600"
                    >Couleur de la carte "Rejet√©es"</span
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Boutons d'action du modal -->
          <div class="px-6 py-4 border-t border-gray-200 bg-gray-50">
            <!-- Ligne de boutons de r√©initialisation -->
            <div class="flex flex-col sm:flex-row gap-3 mb-4">
              <button
                onclick="resetToDefaultColors()"
                class="flex items-center justify-center bg-gray-500 hover:bg-gray-600 text-white px-4 py-2.5 rounded-lg transition duration-200 text-sm font-medium"
              >
                <i class="fas fa-undo mr-2"></i>R√©initialiser le formulaire
              </button>
              <button
                onclick="resetAllThemes()"
                class="flex items-center justify-center bg-red-500 hover:bg-red-600 text-white px-4 py-2.5 rounded-lg transition duration-200 text-sm font-medium"
                title="Supprimer tous les th√®mes sauvegard√©s et revenir aux param√®tres par d√©faut"
              >
                <i class="fas fa-trash mr-2"></i>R√©initialiser tous les th√®mes
              </button>
            </div>

            <!-- Ligne de boutons principaux -->
            <div class="flex flex-col sm:flex-row gap-3 justify-end">
              <button
                onclick="closeThemeCustomizer()"
                class="flex items-center justify-center bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-2.5 rounded-lg transition duration-200 font-medium"
              >
                <i class="fas fa-times mr-2"></i>Annuler
              </button>
              <button
                onclick="applyCustomColors()"
                class="flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg transition duration-200 font-medium shadow-lg"
              >
                <i class="fas fa-check mr-2"></i>Appliquer le th√®me
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL DE CHANGEMENT DE PHOTO DE PROFIL -->
    <div
      id="profilePhotoModal"
      class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden"
    >
      <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
          <div
            class="flex items-center justify-between p-6 border-b border-gray-200"
          >
            <h3 class="text-lg font-bold text-gray-800">
              <i class="fas fa-camera text-blue-500 mr-2"></i>
              Changer la photo de profil
            </h3>
            <button
              onclick="closeProfilePhotoModal()"
              class="text-gray-500 hover:text-gray-700 text-xl"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>

          <div class="p-6">
            <!-- Zone d'aper√ßu -->
            <div class="text-center mb-6">
              <div class="inline-block relative">
                <img
                  id="photoPreview"
                  src="https://cdn-icons-png.flaticon.com/512/1048/1048953.png"
                  alt="Aper√ßu"
                  class="w-24 h-24 rounded-full border-4 border-blue-500 object-cover"
                />
              </div>
              <p class="text-sm text-gray-600 mt-2">
                Formats accept√©s: JPG, PNG, GIF (max 5MB)
              </p>
            </div>

            <!-- S√©lection de fichier -->
            <div class="mb-6">
              <label class="block w-full">
                <input
                  type="file"
                  accept="image/*"
                  onchange="handlePhotoSelection(event)"
                  class="hidden"
                />
                <div
                  class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-500 transition"
                >
                  <i
                    class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"
                  ></i>
                  <p class="text-gray-600">
                    Cliquez pour s√©lectionner une image
                  </p>
                </div>
              </label>
            </div>
          </div>

          <div class="flex justify-between p-6 border-t border-gray-200">
            <button
              onclick="removeProfilePhoto()"
              class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition"
            >
              <i class="fas fa-trash mr-2"></i>Supprimer
            </button>
            <div class="space-x-3">
              <button
                onclick="closeProfilePhotoModal()"
                class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg transition"
              >
                Annuler
              </button>
              <button
                id="savePhotoBtn"
                onclick="saveProfilePhoto()"
                disabled
                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <i class="fas fa-save mr-2"></i>Sauvegarder
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL DE D√âTAILS AM√âLIOR√â -->
    <div
      id="detailsModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div
        class="bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"
      >
        <div
          class="px-6 py-4 bg-gradient-to-r from-blue-900 to-blue-700 text-white rounded-t-xl"
        >
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
              <i class="fa fa-file-text text-xl"></i>
              <h3 class="text-lg font-bold">D√©tails de la Demande</h3>
            </div>
            <button
              onclick="closeDetailsModal()"
              class="text-white hover:text-gray-200 text-xl font-bold"
            >
              √ó
            </button>
          </div>
        </div>

        <div class="p-6">
          <!-- En-t√™te avec statut -->
          <div class="mb-6 p-4 rounded-lg border-l-4" id="detailsStatusBanner">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-3">
                <i id="detailsStatusIcon" class="text-2xl"></i>
                <div>
                  <h4 class="font-semibold text-lg" id="detailsStatusText"></h4>
                  <p
                    class="text-sm text-gray-600"
                    id="detailsStatusSubtext"
                  ></p>
                </div>
              </div>
              <span
                class="px-3 py-1 rounded-full text-sm font-medium"
                id="detailsStatusBadge"
              ></span>
            </div>
          </div>

          <!-- Informations utilisateur -->
          <div class="mb-6">
            <div class="flex items-center space-x-2 mb-3">
              <i class="fa fa-user text-blue-600"></i>
              <h4 class="font-semibold text-gray-800">
                Informations Utilisateur
              </h4>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <span class="text-sm text-gray-600">Nom complet</span>
                  <p class="font-medium" id="detailsUserName"></p>
                </div>
                <div>
                  <span class="text-sm text-gray-600">Adresse email</span>
                  <p
                    class="font-medium text-blue-600"
                    id="detailsUserEmail"
                  ></p>
                </div>
              </div>
            </div>
          </div>

          <!-- Informations de la demande -->
          <div class="mb-6">
            <div class="flex items-center space-x-2 mb-3">
              <i class="fa fa-calendar text-green-600"></i>
              <h4 class="font-semibold text-gray-800">
                Informations de la Demande
              </h4>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <span class="text-sm text-gray-600">Date de demande</span>
                  <p class="font-medium" id="detailsRequestDate"></p>
                </div>
                <div>
                  <span class="text-sm text-gray-600">Date de cr√©ation</span>
                  <p class="font-medium" id="detailsCreatedAt"></p>
                </div>
                <div id="detailsProcessedAtContainer" class="hidden">
                  <span class="text-sm text-gray-600">Date de traitement</span>
                  <p class="font-medium" id="detailsProcessedAt"></p>
                </div>
                <div>
                  <span class="text-sm text-gray-600">Identifiant</span>
                  <p
                    class="font-mono text-sm bg-white px-2 py-1 rounded border"
                    id="detailsRequestId"
                  ></p>
                </div>
              </div>
            </div>
          </div>

          <!-- Historique et actions -->
          <div class="mb-6" id="detailsActionsContainer">
            <div class="flex items-center space-x-2 mb-3">
              <i class="fa fa-history text-purple-600"></i>
              <h4 class="font-semibold text-gray-800">Historique et Actions</h4>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg">
              <div class="space-y-2" id="detailsActionsList">
                <!-- Les actions seront ajout√©es dynamiquement -->
              </div>
            </div>
          </div>
        </div>

        <!-- Pied du modal avec boutons -->
        <div class="px-6 py-4 bg-gray-50 rounded-b-xl border-t">
          <div class="flex justify-end space-x-3">
            <button
              onclick="closeDetailsModal()"
              class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition duration-200"
            >
              Fermer
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- NOTIFICATION -->
    <div id="notification" class="fixed top-4 right-4 z-50 hidden">
      <div class="bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg">
        <span id="notificationText"></span>
      </div>
    </div>

    <script src="../js/access-management-enhanced.js"></script>
  </body>
</html>
